---
issue: 884
title: Freeze on Settings Open
url: https://github.com/mgmeyers/obsidian-kanban/issues/884
author: zral0kh
created: 2024-01-22T02:15:57Z
os: Windows
status: verified
investigation_notes: "Settings freeze on large vaults (50k+ files). Root cause: getFolderChoices() and getTemplateChoices() in settingHelpers.ts use Vault.recurseChildren synchronously, blocking UI while iterating all files/folders. Fix options: 1) Cache results, 2) Async loading with web worker, 3) Virtualized dropdown, 4) Use Obsidian's search API. Complex fix requiring architectural changes."
fix_attempted: true
fix_pr: 'src/settingHelpers.ts - use getAllLoadedFiles filtering instead of recursive traversal'
---

## Description

### Describe the bug

**Observed:**
Whenever the settings menu, both local and global, is opened, obsidian as a whole freezes anywhere from 5 to 15 minutes.
One obsidian sub-process also can consume up to 5GB on my system, this can't be what we want.

**Probable cause:**
My vault is gigantic, >50k files, 2-5k folders.
Whenever the settings menu is opened, `createSearchSelect` from `src/settingHelpers.ts` is invoked, which returns a list of possible paths, that can be used as a default note creation path for the appropriate setting: `Note folder`

(The function is also invoked for the template path, this may also be contributing)

### Expected Behavior

**Behaviour:**
This should take 3-5 seconds.
When using the vault search from Obsidian with:
`path: /`
results are returned within seconds.

**Easy Fix:**
Invoke the obsidian search with the above argument instead and use the returned results.

It would be much harder, to optimize the existing functionality, this also is not necessary, so the easy fix should be used.

### Steps to reproduce

Have a gigantic vault, >5k folders

### Relevant errors (if available)

_No response_

### Operating system

Windows

## Investigation Notes

<!-- To be filled during triage -->

## Fix Attempts

<!-- Document any attempted fixes -->

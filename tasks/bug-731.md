---
issue: 731
title: Initial entry of a task query does not render correctly in kanban card
url: https://github.com/mgmeyers/obsidian-kanban/issues/731
author: jwhitley
created: 2023-02-04T00:15:22Z
os: macOS
status: verified
investigation_notes: "Tasks plugin queries don't render correctly on initial card creation - only first task shows checkbox. Related to #550 (Dataview rendering) and #655 (callouts). External plugin code blocks may not be fully processed by the markdown renderer on initial render. Works after reload."
fix_attempted: false
fix_pr: ""
---

## Description

### Describe the bug

When I add a new Tasks query to a Kanban card, ala:
````
```tasks
not done
path includes Project A
```
````
the resulting card only renders the first task correctly. Subsequent checkboxes and other Tasks decorations are missing. For example, given a note `Project A`:

<img width="1136" alt="Screenshot 2023-02-03 at 8 53 06 AM" src="https://user-images.githubusercontent.com/44155/216672508-f631ef1a-6ff7-4d64-abd6-e12f7f691b15.png">

On initial entry of the card containing a task query, it's rendered as:
<img width="1136" alt="Screenshot 2023-02-03 at 8 53 13 AM" src="https://user-images.githubusercontent.com/44155/216672653-fbdb81b2-1a2e-4be5-b7e0-87278ae96a88.png">

I've confirmed via the inspector that the checkbox and other elements are missing from the DOM on the second (and subsequent) tasks rendered in the card.

**IMPORTANT:** If the note is closed then reopened and/or if Obsidian is exited and restarted, the rendering (usually?) appears to be correct.  The error state can be restored by editing the task card (no changes needed) and hitting enter (or tapping 'Submit') to exit card edit.


### Expected Behavior

All tasks from the query should render correctly at the time of initial card creation.

### Steps to reproduce

This was reproduced in a pristine vault, created via the following steps:

1. Create a new vault
2. Install and enable the Kanban and Tasks plugins
3. Create a note "Project A" with at least two tasks
4. Create a kanban board
5. Add a swimlane to the board
6. In the lane, add a card with a tasks query:
   ````
   ```tasks
   not done
   path includes Project A
   ```
   ````
7. Hit return (or tap "Submit") to end card edit mode

Observe that the card rendering is not correct.

On further testing, in-card rendering also gets weird with very simple queries, such as:
````
```tasks
 not done
```
````
or an empty "all tasks" query:
````
```tasks
```
````
Also render poorly, where tag text and the break element get serialized into monospace in the card ala `tasks<br>`:
<img width="256" alt="Screenshot 2023-02-03 at 10 05 03 AM" src="https://user-images.githubusercontent.com/44155/216675391-c49c684f-302c-4cfd-aac8-905f47cdde73.png">

The above repro case was tested on macOS, but I've also seen the "in the wild" version in my main vault happening on iPad.

### Relevant errors (if available)

_No response_

### Operating system

macOS

## Investigation Notes
<!-- To be filled during triage -->

## Fix Attempts
<!-- Document any attempted fixes -->
